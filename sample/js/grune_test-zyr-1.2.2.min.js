/*! grune_test-zyr - v1.2.2 - 2020-05-13 */
var cas=document.getElementById("cas"),context=cas.getContext("2d");function Wipe(e){this.id=e.id,this.width=e.width,this.height=e.height,"img"===e.coverType&&(this.img1=new Image,this.img1.src=e.mask),"color"===e.coverType&&(this.mask=e.mask),this.radius=e.radius,this.isMouseDown=!1,this.posX=0,this.posY=0,this.init(),this.addEvent()}context.fillStyle="#666",context.fillRect(0,0,320,569),context.globalCompositeOperation="destination-out",Wipe.prototype.init=function(){this.device=/android|webos|iPhone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase()),this.clickEvent=this.device?"touchstart":"mousedown",this.moveEvent=this.device?"touchmove":"mousemove",this.endEvent=this.device?"touchend":"mouseup"},Wipe.prototype.addEvent=function(){};var options1={id:"cas",width:"320",height:"568",coverType:"img",mask:"wipe2.jpg",radius:30},options2={id:"box",width:"200",height:"100",coverType:"color",mask:"red",radius:30},wipe1=new Wipe(options1),wipe2=new Wipe(options2);function drawArc(e,t,i){e.beginPath(),e.arc(t,i,20,0,2*Math.PI),e.fillStyle="red",e.fill()}function drawLine(e,t,i,o,n){e.beginPath(),e.moveTo(t,i),e.lineTo(o,n),e.lineCap="round",e.lineWidth=20,e.strokeStyle="red",e.stroke()}function getPercentage(e,t,i){for(var o=0,n=e.getImageData(0,0,t,i),s=0;s<i;s++)for(var c=0;c<t;c++){var a=4*(t*s+c)+3;0===n.data[a]&&o++}return o/(t*i)*100}console.log(wipe1);var isMouseDown=!1,posX=0,posY=0;cas.addEventListener(clickEvent,function(e){var t=e||window.event;posX=device?t.touches[0].clientX:t.clientX,posY=device?t.touches[0].clientY:t.clientY,drawArc(context,posX,posY),isMouseDown=!0},!1),cas.addEventListener(moveEvent,function(e){if(!isMouseDown)return!1;var t=e||window.event,i=device?t.touches[0].clientX:t.clientX,o=device?t.touches[0].clientY:t.clientY;drawLine(context,posX,posY,i,o),posX=device?t.touches[0].clientX:t.clientX,posY=device?t.touches[0].clientY:t.clientY},!1),cas.addEventListener(endEvent,function(e){isMouseDown=!1;e||window.event;console.log("透明点占总面积为"+getPercentage(context,320,568).toFixed(2)+"%"),60<getPercentage(context,320,568).toFixed(2)&&alert("擦除面积超过了60%")});